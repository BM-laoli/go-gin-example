# ç¯å¢ƒè¯´æ˜

> é¦–å…ˆæ˜¯å®‰è£…ï¼Œprotobuf çš„è¿‡ç¨‹å’Œé…ç½® æœ¬åœ°å¼€å‘ç¯å¢ƒå˜é‡

1. å®‰è£…

æˆ‘æ˜¯macç”µè„‘ï¼Œç›´æ¥å®‰è£…å°±å¥½å•¦

```shell
$ brew install protobuf 
# å¦‚æœæ‚¨é‡è§äº†ä¸€äº› å®‰è£…çš„æŠ¥é”™ï¼Œæ¯”å¦‚å®‰äº†ä¸€èˆ¬ï¼Œè¿˜å‰©ä¸€åŠï¼Œè¿™ä¸ªæ—¶å€™ï¼Œè¯·æœ‰å¯èƒ½æ‰¾ä¸åˆ°å¯¹åº”çš„tackidçš„æ–‡ä»¶ï¼Œä½ éœ€è¦æ¸…ç†ä¸€ä¸‹
# brew çš„ç¼“å†² ç„¶åå†é‡æ–° brew install 

Warning: Bottle missing, falling back to the default domain...
==> Downloading https://ghcr.io/v2/homebrew/core/protobuf/manifests/3.17.3
Already downloaded: /Users/administrator/Library/Caches/Homebrew/downloads/6d20d704ec9f8c1fe7646d23a2e0e96e28c081140c98ef75911b36eae4e91f6f--protobuf-3.17.3.bottle_manifest.json
==> Downloading https://ghcr.io/v2/homebrew/core/protobuf/blobs/sha256:ef7a56961
==> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sh
######################################################################## 100.0%
==> Installing dependencies for protobuf: six
==> Installing protobuf dependency: six
==> Pouring six-1.16.0_1.arm64_big_sur.bottle.tar.gz
Error: No such file or directory @ rb_sysopen - /Users/administrator/Library/Caches/Homebrew/downloads/b2d32282c41ba4907220501baebea0c80fcc339a9b91684245d54261c17360b0--six-1.16.0_1.arm64_big_sur.bottle.tar.gz

# æ¯”å¦‚ç°åœ¨å°±æ˜¯ æ‰¾ä¸åˆ° /Users/administrator/Library/Cachesä¸‹çš„è¿™ä¸ªidå·çš„é—®é¢˜ï¼Œä½ å¯ä»¥å…ˆæŠŠ Caches ä¸‹éƒ½æ¸…ç†ä¸€éï¼Œåœ¨é‡æ–°å®‰è£…
```

2. å…³äºgoå‡çº§

```shell
brew upgrade go
```

3. å…³äº protoc xxxæŒ‡ä»¤é”™è¯¯

```shell
$ protoc --go-grpc_out= ./search.proto 
protoc-gen-go-grpc: program not found or is not executable
Please specify a program using absolute path or make sure the program is available in your PATH system variable
--go-grpc_out: protoc-gen-go-grpc: Plugin failed with status code 1.

```

é¦–å…ˆå…ˆå®‰è£…ç¡®ä¿ ä¸€äº›æ­£ç¡®çš„æ–‡ä»¶ ï¼ˆåœ¨ä½ çš„é¡¹ç›®rootä¸‹ï¼‰

```shell
$ go get -u google.golang.org/grpc

# ä»»é€‰å…¶ä¸€å¦‚æœæœ‰é—®é¢˜
$ go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
$ go get -u github.com/golang/protobuf/protoc-gen-go

```

ç„¶å ç¡®ä¿ä½ çš„go env çš„bin æ‰§è¡Œæ˜¯æœ‰å…³è”çš„

```shell
$ go env 
# å…ˆçœ‹çœ‹ go path å’Œ go bin æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœä¸ï¼Œè¯·å»ä¿®æ”¹,æˆ‘è¿™é‡Œæ˜¯ zshrc ï¼Œ åŠ å…¥ä¸‹é¢çš„å†…å®¹ï¼Œç„¶åæ›´æ–°å°±å¥½å•¦ source ~/.zshrc      ,æœ€åå» go env æ£€æŸ¥ä¸€ä¸‹çœ‹çœ‹æ˜¯å¦å·²ç»é…ç½®å®Œï¼Œå¦‚æœæ˜¯é‚£ä¹ˆä¹…å®Œæˆå•¦
export GOPATH=$HOME/go
export GOBIN=$GOPATH/bin
export PATH=$PATH:$GOPATH/bin

```

4. ä¾æ®åè®® æ¥è½¬è¯‘ çš„æ—¶å€™ï¼Œå¤±è´¥çš„é—®é¢˜

ä½ éœ€è¦ç”¨è‡ªå·±çš„åŒ…ï¼Œæ¯”å¦‚ æˆ‘è‡ªå·±çš„ github.com/BM-laoli/go-gin-example/proto

```go
syntax = "proto3";

package proto;

option go_package ="github.com/BM-laoli/go-gin-example/proto";

service SearchService {
    rpc Search(SearchRequest) returns (SearchResponse) {}
}

message SearchRequest {
    string request = 1;
}

message SearchResponse {
    string response = 1;
}

```

ç¬¬äºŒï¼Œä½ åœ¨ protoc ğŸ”§, (æ‰§è¡Œçš„æ–‡ä»¶å¤¹åœ¨é¡¹ç›®çš„æ ¹ç›®å½•go-gin-exampale)

```shell
$ protoc --go_out=. --go_opt=paths=source_relative \
    --go-grpc_out=. --go-grpc_opt=paths=source_relative \
    proto/search.proto
```

è¿™ä¸ªå‘½ä»¤å®Œä¹‹åå›ç”Ÿäº§ä¸¤ä¸ª æ–‡ä»¶ï¼Œå…·ä½“è¯·çœ‹å®˜æ–¹æ–‡æ¡£ [go-rpcå®˜æ–¹æ–‡æ¡£](https://grpc.io/docs/languages/go/quickstart/)

ç¬¬ä¸‰ï¼Œä½ éœ€è¦ å®ç°å®ƒ

```go
type SearchService struct {
 pb.SearchServiceServer
}
```
